<!DOCTYPE html>
<html lang="zh-CN">
<head>
    <meta charset="UTF-8">
    <title>悠真伤害计算器</title>
    <link rel="stylesheet" href="style.css">
</head>
<body>

<div class="col-left">
    <h2>悠真核心参数</h2>
    <div class="input-group">
        <label class="label-text">命座等级</label>
        <select id="y_const" onchange="update()">
            <option value="0">0 命</option><option value="1">1 命</option><option value="2">2 命</option>
            <option value="3">3 命</option><option value="4">4 命</option><option value="5">5 命</option><option value="6">6 命</option>
        </select>
    </div>
    <div class="base-panel-grid">
        <div><label class="label-text">攻击力</label><input type="number" id="p_atk" value="3000" oninput="update()"></div>
        <div><label class="label-text">暴击率 (%)</label><input type="number" id="p_cr" value="50" oninput="update()"></div>
        <div><label class="label-text">暴击伤害 (%)</label><input type="number" id="p_cd" value="120" oninput="update()"></div>
        <div><label class="label-text">穿透率 (%)</label><input type="number" id="p_pen_r" value="0" oninput="update()"></div>
        <div><label class="label-text">电伤加成 (%)</label><input type="number" id="p_ele_dmg" value="0" oninput="update()"></div>
        <div><label class="label-text">穿透值</label><input type="number" id="p_pen_v" value="0" oninput="update()"></div>
    </div>

    <div class="check-item" style="color:var(--cyan); border: 1px solid #00e5ff33; padding: 10px; border-radius: 4px; margin-top: 15px;">
        <input type="checkbox" id="m_strong" onchange="handleToggleCondition()"> <strong>开启【潜能模式】</strong>
    </div>

    <h2>武器与驱动盘</h2>
    <div class="input-group">
        <label class="label-text">悠真武器</label>
        <select id="y_wp" onchange="update()">
            <option value="none">无武器</option>
            <option value="lh">硫磺石</option>
            <option value="cx">残心青囊</option>
            <option value="xh">星辉音擎</option>
        </select>
    </div>
    <div class="input-group">
        <label class="label-text">精炼等级</label>
        <select id="y_ref" onchange="update()"><option value="1">1</option><option value="2">2</option><option value="3">3</option><option value="4">4</option><option value="5">5</option></select>
    </div>
    <div class="input-group">
        <label class="label-text">驱动盘四件套</label>
        <select id="s4_set" onchange="update()">
            <option value="none">无</option>
            <option value="ry">如影随形</option>
            <option value="lb">雷暴重金属</option>
        </select>
    </div>

    <h2>环境与队友 Buff</h2>
    <div class="check-item"><input type="checkbox" id="env_break" onchange="handleToggleCondition()"> 敌人处于【失衡】</div>
    <div class="check-item"><input type="checkbox" id="env_abnormal" onchange="update()"> 敌人处于【异常】</div>

    <div class="check-item"><input type="checkbox" id="b_yjy" onchange="handleTeammateToggle('yjy')"> 队友：耀嘉音</div>
    <div id="sub_yjy" style="display:none; padding-left:15px; border-left: 2px solid #444; margin-bottom:10px;">
        <label class="label-text">耀嘉音面板攻击</label><input type="number" id="yjy_atk" value="3000" oninput="update()">
        <label class="label-text">命座</label>
        <select id="yjy_const" onchange="update()"><option value="0">0命</option><option value="1">1命</option><option value="2">2命+</option></select>
    </div>

    <div class="check-item"><input type="checkbox" id="b_ly" onchange="handleTeammateToggle('ly')"> 队友：琉音</div>
    <div id="sub_ly" style="display:none; padding-left:15px; border-left: 2px solid #444; margin-bottom:10px;">
        <label class="label-text">命座</label>
        <select id="ly_const" onchange="update()"><option value="0">0命</option><option value="1">1命</option><option value="2">2命+</option></select>
        <label class="label-text">武器：昨夜来电</label>
        <select id="ly_wp_select" onchange="update()">
            <option value="none">无武器</option>
            <option value="zn">昨夜来电</option>
        </select>
        <label class="label-text">武器精炼等级</label>
        <select id="ly_ref" onchange="update()"><option value="1">1</option><option value="2">2</option><option value="3">3</option><option value="4">4</option><option value="5">5</option></select>
    </div>

    <div class="check-item"><input type="checkbox" id="b_bj" onchange="handleTeammateToggle('bj')"> 队友：扳机</div>
    <div id="sub_bj" style="display:none; padding-left:15px; border-left: 2px solid #444; margin-bottom:10px;">
        <label class="label-text">命座</label>
        <select id="bj_const" onchange="update()"><option value="0">0命</option><option value="1">1命+</option><option value="2">2命+</option></select>
        <label class="label-text">武器：索魂影眸</label>
        <select id="bj_wp_select" onchange="update()">
            <option value="none">无武器</option>
            <option value="sh">索魂影眸</option>
        </select>
        <label class="label-text">武器精炼等级</label>
        <select id="bj_ref" onchange="update()"><option value="1">1</option><option value="2">2</option><option value="3">3</option><option value="4">4</option><option value="5">5</option></select>
    </div>

    <div class="check-item"><input type="checkbox" id="b_nk" onchange="update()"> 队友：妮可</div>
    <div class="check-item"><input type="checkbox" id="b_ap" onchange="update()"> 队友携带音擎“阿炮”</div>
    <div class="check-item"><input type="checkbox" id="b_mg" onchange="update()"> 队友携带驱动盘“月光”</div>
    <div class="check-item"><input type="checkbox" id="b_jy" onchange="update()"> 队友携带驱动盘“佳音”</div>
    <div class="check-item"><input type="checkbox" id="b_sdx" onchange="update()"> 队友携带驱动盘“山大王”</div>

    <h2>敌人属性</h2>
    <div class="input-group"><label class="label-text">基础防御</label><input type="number" id="e_def" value="952.8" oninput="update()"></div>
    <div class="input-group"><label class="label-text">初始抗性%</label><input type="number" id="e_res" value="0" oninput="update()"></div>
    <div class="input-group"><label class="label-text">基础失衡易伤%</label><input type="number" id="e_vun" value="150" oninput="update()"></div>
</div>

<div class="col-mid">
    <h2>连招序列</h2>
    <div id="q_list"></div>
    
    <hr style="border:0; border-top:1px solid #333; margin:20px 0;">
    
    <label class="label-text">选择动作</label>
    <select id="sk_sel">
        <option value="cx1">冲刺攻击·飞弦斩一段</option>
        <option value="cx2">冲刺攻击·飞弦斩二段</option>
        <option value="cx3">冲刺攻击·飞弦斩三段</option>
        <option value="tq">强化特殊技：地网</option>
        <option value="tq_x">强化特殊技：地网·巡弋</option>
        <option value="support">快速支援</option>
        <option value="lx">连携技</option>
        <option value="zj">终结技</option>
        <option value="pg">普攻·落羽</option>
        <option value="pg4">普攻·穿云第四段</option>
        <option value="pg5">普攻·穿云第五段</option>
        <option value="dcb">电磁爆 (仅6命)</option>
    </select>
    <button class="btn-add" onclick="addSkill()">+ 添加到队列</button>
    
    <div style="display:grid; grid-template-columns: 1fr 1fr; gap:10px; margin-top:15px;">
        <button class="btn-action" onclick="exportConfig()">导出参数配置</button>
        <button class="btn-action" onclick="importConfig()">导入参数配置</button>
    </div>
    <button onclick="clearQueue()" style="width:100%; margin-top:10px; color:var(--red); background:none; border:1px solid var(--red); cursor:pointer; padding:10px; border-radius:4px;">清空序列</button>
</div>

<div class="col-right">
    <div class="summary-banner">
        <div><div style="font-size:0.8rem; color:#888;">全序列总暴击伤害</div><div class="res-big" id="total_crit">0</div></div>
        <div><div style="font-size:0.8rem; color:#888;">全序列总期望伤害</div><div class="res-big" id="total_exp" style="color:var(--cyan)">0</div></div>
    </div>
    <div class="chart-container" id="damage_chart" style="display:none;">
        <div class="chart-title">技能类型伤害占比 (基于期望)</div>
        <div id="chart_bars"></div>
    </div>
    <div id="selected_detail_summary" class="selected-banner" style="display:none;">
        <div><div style="font-size:0.75rem; color:#aaa;">选中动作·暴击伤害</div><div class="res-mid" id="sel_crit">0</div></div>
        <div><div style="font-size:0.75rem; color:#aaa;">选中动作·期望伤害</div><div class="res-mid" id="sel_exp" style="color:var(--gold)">0</div></div>
    </div>
    <div id="detail_area"></div>
</div>

<script src="script.js"></script>
</body>
</html>